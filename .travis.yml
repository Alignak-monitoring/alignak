language: python
sudo: true
python:
  - "2.7"
#
#services:
#  - mongodb

# command to install dependencies
# some are only used for travis/coveralls so we are installing them here only
install:
  # Remove python warnings
  - unset PYTHONWARNINGS
  - ./test/setup_test.sh

# command to run tests
script:
  # To help eventual debug, knowing which exact packages are installed can be rather useful ;)
  - pip freeze

  # Code static analysis
  # todo...

  # Virtual environment setup tests
  - set -ev
  - ./test/test_virtualenv_setup.sh

  # Run tests and code dynamic analysis
  - cd test

  # Delete previously existing coverage results
  - coverage erase

  # Run test suite with py.test running its coverage plugin
  # Verbose mode to have the test list
  # Dump the 10 slowest tests
  - pytest --durations=10 --cov=alignak --cov-report term-missing --cov-config .coveragerc test_*.py
  # Report about coverage
  - coverage report -m
  - cd ..

after_success:
  # to get coverage data with relative paths and not absolute we have to
  # execute coveralls from the base directory of the project,
  # so we need to move the .coverage file here :
  - mv test/.coverage . && coveralls --rcfile=test/.coveragerc -v
